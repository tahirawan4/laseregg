{% extends "base_bs.html" %}
{% block title %}Sensor {% endblock %}


{% block body %}
    <style>
        .option {
            display: none;
        }
    </style>

    <div class="row" id="toolbar">
        <div class='col-sm-12'>
            <div id="toolbar01">
                <form action="" method='post'>
                    {% csrf_token %}
                    <div class='row'>
                        <div class='col-sm-8'>

                            ID 1: <input type="text" id="id1" name="id1" size="20">
                            <button type="button" id="button-1">Refresh</button>
                            &nbsp;&nbsp;<input type="text" size="4" id="id1_reading" name="id1_reading"> <br>
                            ID 2: <input type="text" id="id2" name="id2" size="20">
                            <button type="button" id="button-2">Refresh</button>
                            &nbsp;&nbsp;<input type="text" size="4" id="id2_reading" name="id2_reading"> <br>
                            ID 3: <input type="text" id="id3" name="id3" size="20">
                            <button type="button" id="button-3">Refresh</button>
                            &nbsp;&nbsp;<input type="text" size="4" id="id3_reading" name="id3_reading"> <br>
                            ID 4: <input type="text" id="id4" name="id4" size="20">
                            <button type="button" id="button-4">Refresh</button>
                            &nbsp;&nbsp;<input type="text" size="4" id="id4_reading" name="id4_reading"> <br>

                        </div>
                        <div class='col-sm-4'>
                            Test Monitor<br>
                            {#                            <form id="suggestions">#}
                            <div id="suggested_ids" onfocusout='hideOptions()'>
                                <input type="text"
                                       id="insertText"
                                       autocomplete="off" maxlength="4"
                                />

                            </div>
                            {#                            </form>#}
                        </div>

                    </div>


                    Start Date
                    <div class="form-group">
                        <div class='input-group date' id='datetimepicker2'>
                            <input type='text' class="form-control" name="end_date"/>
                            <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                        </div>
                    </div>

                    End Date
                    <div class="form-group">
                        <div class='input-group date' id='datetimepicker1'>
                            <input type='text' class="form-control" name="start_date"/>
                            <span class="input-group-addon">
                        <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                        </div>
                    </div>


                    <input type="submit" value="Submit">


                </form>
                <br>
                <br>
                {#                <div>#}
                {#                    <form id="suggestions">#}
                {#                        <div id="suggested_ids" onfocusout='hideOptions()'>#}
                {#                            <input type="text"#}
                {#                                   id="insertText"#}
                {#                                   autocomplete="off" maxlength="4"#}
                {#                            />#}
                {##}
                {#                        </div>#}
                {#                    </form>#}
                {#                </div>#}

                <script type="text/javascript">
                    var main_counter = 0;

                    $(document).ready(function () {

                        showOptions = function () {
                            $('.option').show();
                        }

                        hideOptions = function () {
                            $('.option').hide();
                        }

                        searchAddress = function (text) {
                            main_counter++;
                            time_id = '#id' + main_counter;
                            reading_id = '#id' + main_counter + '_reading';
                            time_id_reading = text.split(',');
                            $(time_id).val(time_id_reading[0]);
                            $(reading_id).val(time_id_reading[1])
                            $('.option').hide();
                            $('#suggested_ids').find('option').remove().end();
                            if (main_counter == 4)
                                main_counter = 0;
                        }
                    });


                    $('#button-1,#button-2,#button-3,#button-4').click(function (e) {
                        button_id = e.target.id;
                        index = button_id.split('-');
                        time_id_latest = '#id' + index[1];
                        $.ajax({

                            url: "{% url  'get_latest_reading' %}",
                            type: "post",
                            data: {
                                'time_id': $(time_id_latest).val(),
                                'csrfmiddlewaretoken': '{{csrf_token}}',
                            },
                            dataType: "json",
                            success: function (data) {
                                button_lastest_id = '#id' + index[1] + '_reading';
                                $(button_lastest_id).val(data['data']);

                            }
                        });

                    });


                    $('#insertText').on('keydown', function (e) {
                        if (e.which == 8 || e.which == 46) {
                            $('.option').hide();
                            $('#suggested_ids').find('option').remove().end();
                        }
                    });

                    $("#insertText").on('input', function () {

                        if ($('#insertText').val().length == 4) {

                            $.ajax({

                                url: "{% url 'fetchmac' %}",
                                type: "post",
                                data: {
                                    'mac_id': $('#insertText').val(),
                                    'csrfmiddlewaretoken': '{{csrf_token}}',
                                },
                                dataType: "json",
                                success: function (data) {
                                    options = data.options;

                                    for (index = 0; index < options.length; ++index) {
                                        option = options[index];
                                        $('#suggested_ids').append($('<option>', {
                                            text: option.text,
                                            id: 'option' + (index + 1),
                                            onmousedown: "searchAddress(option" + (index + 1) + ".value)",
                                            class: "option",
                                            value: option.value

                                        }));

                                    }
                                    showOptions();

                                }
                            });
                        }

                    });

                    $(function () {
                        $('#datetimepicker1').datetimepicker();
                        $('#datetimepicker2').datetimepicker();
                    });

                </script>
            </div>
        </div>


    </div>
    </div>

    </div>

    <div class='row'>
        <div class='col-lg-12'>
        </div>
    </div>
{% endblock %}
